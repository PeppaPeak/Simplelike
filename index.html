<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Roguelike Prototype</title>
<style>
  body {margin:0; background:#f7f7f7; font-family:Arial;}
  canvas {background:#fff; display:block; margin:0 auto; border:1px solid #ccc;}
  .ui {position:absolute; top:10px; left:10px; background:rgba(255,255,255,0.9); padding:10px; border-radius:6px;}
  .wave-desc {position:absolute; bottom:10px; left:50%; transform:translateX(-50%); background:#fff; padding:6px 12px; border-radius:6px; box-shadow:0 2px 8px rgba(0,0,0,0.2);}
</style>
</head>
<body>
<canvas id="game" width="1000" height="600"></canvas>
<div class="ui" id="ui">HP: <span id="hp">10</span> | XP: <span id="xp">0</span> | Level: <span id="level">1</span> | Weapon: <span id="weapon">-</span></div>
<div class="wave-desc" id="waveDesc">Wave 1</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const CONFIG = {
  playerSpeed: 180,
  playerMaxHp: 10,
  xpToLevel: lvl=>3+lvl,
  spawnDelay: 200,
  canvas: {w:1000,h:600}
};

canvas.width=CONFIG.canvas.w; canvas.height=CONFIG.canvas.h;

let keys={};
window.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

let player = {
  x:canvas.width/2, y:canvas.height/2,
  hp:CONFIG.playerMaxHp, maxHp:CONFIG.playerMaxHp,
  speed:CONFIG.playerSpeed,
  level:1, xp:0,
  ownedWeapons:{}, currentWeaponId:null
};

const WEAPONS = {
  orb: {name:'Orb', type:'orb', dmg:1},
  ring: {name:'Ring', type:'ring', dmg:1},
  gun: {name:'Gun', type:'projectile', dmg:1}
};

// Give initial weapon
player.ownedWeapons['orb']={...WEAPONS.orb};
player.currentWeaponId='orb';

// Enemies & bullets
let enemies = [], bullets = [], wave=1, spawnQueue=[], spawnTimer=0;

function rand(a,b){return a+Math.random()*(b-a);}
function choose(arr){return arr[Math.floor(Math.random()*arr.length)];}
function dist(x1,y1,x2,y2){return Math.hypot(x1-x2,y1-y2);}

// Enemy template
const ENEMY_TEMPLATES = {
  circle:{hp:3,speed:60,color:'red',size:15,xp:1},
  square:{hp:6,speed:40,color:'blue',size:25,xp:2},
  triangle:{hp:2,speed:100,color:'green',size:12,xp:1}
};

// Prepare wave
function prepareWave(n){
  wave=n; enemies=[]; bullets=[]; spawnQueue=[];
  const types = Object.keys(ENEMY_TEMPLATES);
  for(let i=0;i<5+n;i++){ spawnQueue.push(choose(types)); }
  document.getElementById('waveDesc').innerText='Wave '+n;
}

// Spawn enemy from queue
function spawnEnemy(){
  if(spawnQueue.length===0) return;
  const name = spawnQueue.shift();
  const t = ENEMY_TEMPLATES[name];
  let side = Math.floor(Math.random()*4);
  let x,y;
  if(side===0){x=-30; y=rand(0,canvas.height);}
  else if(side===1){x=canvas.width+30; y=rand(0,canvas.height);}
  else if(side===2){y=-30; x=rand(0,canvas.width);}
  else{y=canvas.height+30; x=rand(0,canvas.width);}
  enemies.push({x,y,hp:t.hp,maxHp:t.hp,color:t.color,size:t.size,speed:t.speed,name:name,xp:t.xp});
}

// Game loop
let lastTime=performance.now();
function gameLoop(now){
  const dt=(now-lastTime)/1000; lastTime=now;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Player movement
  let dx=0,dy=0;
  if(keys['w']||keys['arrowup']) dy-=1;
  if(keys['s']||keys['arrowdown']) dy+=1;
  if(keys['a']||keys['arrowleft']) dx-=1;
  if(keys['d']||keys['arrowright']) dx+=1;
  const len=Math.hypot(dx,dy);
  if(len>0){ dx/=len; dy/=len; }
  player.x+=dx*player.speed*dt; player.y+=dy*player.speed*dt;
  player.x= Math.max(0,Math.min(canvas.width,player.x));
  player.y= Math.max(0,Math.min(canvas.height,player.y));

  // Spawn enemies
  spawnTimer+=dt*1000;
  if(spawnTimer>CONFIG.spawnDelay){ spawnEnemy(); spawnTimer=0; }

  // Draw enemies
  enemies.forEach(e=>{
    ctx.fillStyle=e.color;
    ctx.beginPath();
    ctx.arc(e.x,e.y,e.size,0,Math.PI*2);
    ctx.fill();
    // Move toward player
    const dxp=player.x-e.x, dyp=player.y-e.y;
    const len=Math.hypot(dxp,dyp);
    if(len>0){ e.x+=dxp/len*e.speed*dt; e.y+=dyp/len*e.speed*dt; }
  });

  // Draw player
  ctx.fillStyle='orange';
  ctx.beginPath();
  ctx.arc(player.x,player.y,20,0,Math.PI*2);
  ctx.fill();

  // Update UI
  document.getElementById('hp').innerText=Math.round(player.hp);
  document.getElementById('xp').innerText=player.xp;
  document.getElementById('level').innerText=player.level;
  document.getElementById('weapon').innerText=player.currentWeaponId;

  requestAnimationFrame(gameLoop);
}

prepareWave(1);
gameLoop(performance.now());
</script>
</body>
</html>
